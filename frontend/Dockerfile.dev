FROM node:18

WORKDIR /app

# Copier seulement package.json + package-lock.json / yarn.lock
COPY package*.json ./

# Installer dépendances avec legacy-peer-deps pour éviter conflits
RUN npm install --legacy-peer-deps

# Installer expo-cli globalement
RUN npm install -g expo-cli

# Copier le reste du code (pour dev, on peut aussi monter en volume via docker-compose)
COPY . .

# Exposer les ports d'Expo
EXPOSE 19000 19001 19002

# Variable environnement pour Expo
ENV EXPO_DEVTOOLS_LISTEN_ADDRESS=0.0.0.0

# Commande pour démarrer Expo en mode tunnel et non interactif
CMD ["expo", "start", "--tunnel", "--non-interactive"]
